version: '3.4'

services:
#  kdemo.webapp:
#    image: kdemo.webapp
#    build:
#      context: .
#      dockerfile: web/WebApp/Dockerfile

  post-api:
    image: post-api
    build:
      context: .
      dockerfile: api/Posts.API/Dockerfile
    depends_on:
      - rabbitmq
      - sql-data
    restart: on-failure
    env_file: .env
    networks:
      - main-network

  posts-wiki:
    image: posts-wiki
    build:
      context: .
      dockerfile: sources/Posts.Wiki/Dockerfile
    depends_on:
      - rabbitmq
      - post-api
    restart: on-failure
    env_file: .env
    networks:
      - main-network

  posts-reddit:
    image: posts-reddit
    build:
      context: .
      dockerfile: sources/Posts.Reddit/Dockerfile
    depends_on:
      - rabbitmq
      - post-api
    restart: on-failure
    env_file: .env
    networks:
      - main-network

  sql-data:
    image: sql-data
    build:
      context: ./database
      dockerfile: Dockerfile
    env_file: .env
    networks:
      - main-network

  rabbitmq:
    image: rabbitmq:3-management
    env_file: .env
    networks:
      - main-network

networks:
  main-network:
    driver: bridge